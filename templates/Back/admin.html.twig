<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    {% block stylesheet %}
        <link rel="stylesheet" href="{{ asset('css/bootstrap.css') }}">
        <link href="https://fonts.googleapis.com/css?family=Assistant:200,300,400,600,700,800|Playfair+Display:400,700" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/fh-3.1.4/r-2.2.2/datatables.min.css"/>
        <link href="{{ asset('/css/style/style.css') }}" rel="stylesheet" />
        <link href="{{ asset('/css/style/admin/admin.css') }}" rel="stylesheet" />
        <link href="{{ asset('/css/style/menu.css') }}" rel="stylesheet" />
        <link href="{{ asset('/css/style/floating-label.css') }}" rel="stylesheet" />
        <link href="{{ asset('fonts/font-awesome.css') }}" rel="stylesheet" />
    {% endblock %}
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Si icone -->
    {#<link rel="icon" type="image/ico" href="/images/ico-livre.ico" />#}
    <!--[if IE]><link rel="shortcut icon" type="image/x-icon" href="images/velo-marqueur.png" /><!-->

    {% block meta %}
        <!-- Création des metatags réseaux sociaux -->
        <!-- Metatags FB -->
        <meta property="og:title" content="Gestion clients MySPA" />
        <meta property="og:type" content="Gestion clients MySPA" />
        <meta property="og:url" content="crmmyspa.mclwebservices.com" />
        <meta property="og:description" content="Gestion clients MySPA" />
        <meta property="og:image" content="/css/images/" />

        <!-- Metatag Twitter -->
        <meta name="twitter:card" content="Gestion clients MySPA" />
        <meta name="twitter:tittle" content="Gestion clients MySPA" />
        <meta name="twitter:description" content="Gestion clients MySPA" />
    {% endblock %}
    <title>
        {% block title %}
            Administration
        {% endblock %}
    </title>

    {% block stylesheets %}
    {% endblock %}
</head>

<body>
{% block body %}
    <div class="menu-container">
        <div class="burger">
            <span class="line-1"></span>
            <span class="line-2"></span>
            <span class="line-3"></span>
        </div>
        <!-- NAV -->
        <div class="navigation">
            <ul class="menu-content">
                <li><a href="{{ path('admin') }}"><i class="fa fa-home"></i> <span class="nav-name">Home</span></a></li>
                <li><a href="{{ path('showMap') }}"><i class="fa fa-map"></i> <span class="nav-name">Carte</span> </a></li>
                <li><a href="#"><i class="fa fa-smile-o"></i> <span class="nav-name">Clients</span> </a></li>
                    <ul class="sub-nav-content">
                        <li><a href="{{ path('showAllShops') }}">Voir tous</a></li>
                        <li><a href="{{ path('creationShop') }}">Ajouter un magasin</a></li>
                    </ul>
            </ul>
        </div>
    </div>
    {% block container %}
        <div class=" page-title-info-admin content">
            <i class="fa fa-home fa-3x"></i> <h2>Admin</h2>
        </div>
        <div class="container-fluid content">
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 infos-admin-title-container">
                    <h2 class="title-admin">Alertes</h2>
                    {#<span class="button-title-container"><a href="{{ path('admin') }}"><button type="button" class="button-title"><i class="fas fa-arrow-alt-circle-right"></i> Retour</button> </a></span>#}
                </div>
            </div>
            <div class="row ">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <p>1/ Nombre de clients par département</p>
                    <p>2/ Le CA total par département</p>
                    {% for shop in shops %}
                        {% for dept in shop.region.departements %}
                            {{ dept.departement }}
                            {% endfor %}
                    {% endfor %}
                </div>
            </div>

            <!-- Recontact spa -->
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <h5>SPA non recontactés depuis 2 mois</h5>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    {% for shopNoMessage in shopNoMessages  if shopNoMessage is not null%}
                        <p><a href="{{ path('showOneShop', { 'slug': shopNoMessage.slug }) }}">{{ shopNoMessage.name}}</a></p>
                    {% else %}
                        <p>Pas de clients non recontactés depuis 2 mois.</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Recontact spa -->
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <h5>Clients sans commandes depuis 3 Mois</h5>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    {% for shopNoCommande in shopNoCommandes if shopNoCommande is not null%}
                            <p><a href="{{ path('showOneShop', { 'slug': shopNoCommande.slug }) }}">{{ shopNoCommande.name }}</a></p>
                        {% else %}
                        <p>Pas de magasin n'ayant pas passé de commande depuis moins de 3 mois.</p>
                    {% endfor %}
                </div>
            </div>

            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 infos-admin-title-container">
                    <h2 class="title-admin">Indicateurs</h2>
                    {#<span class="button-title-container"><a href="{{ path('admin') }}"><button type="button" class="button-title"><i class="fas fa-arrow-alt-circle-right"></i> Retour</button> </a></span>#}
                </div>
            </div>
            <!-- CHARTS -->
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <div id="container-charts"></div>
                    <div id="container-charts-prospect"></div>
                </div>
            </div>

    </div>
    {% endblock %}

{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/jquery.js') }}"></script>
    <script src="{{ asset('js/bootstrap.js') }}"></script>
    <script src="{{ asset('js/active-menu.js') }}"></script>
    <script src='https://cloud.tinymce.com/stable/tinymce.min.js'></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/fh-3.1.4/r-2.2.2/datatables.min.js"></script>
{% endblock %}

{% block charts %}
    <script type="text/javascript">
        $(function () {
            var myChart = Highcharts.chart('container-charts', {
                chart: {
                    type: 'column',
                    plotBackgroundColor: null,
                    plotBorderWidth: 0,
                    plotShadow: false
                },
                title: {
                    text: 'Répartition <br>des clients<br>par region',
                    align: 'center',
                    verticalAlign: 'middle',
                    y: 40
                },
                // tooltip: {
                //     pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                // },
                xAxis: {
                    categories: [{%  if shops is defined %}{% for key, shop in shops %} '{{ key }}', {% endfor %}{% endif %}]
                },
                series: [{
                    data: [
                        {%  if shops is defined %}
                            {% for details in shops %}
                        {% for detail in details %}
                        {% for dept in detail.region.departements %}
                        {{ dept.departement }}
                            {% endfor %}
                            {% endfor %}
                            {% endfor %}
                        {% endif %}
                    ],
                    showInLegend: false
                }]
            });
        });
    </script>
    <script type="text/javascript">
        $(function () {
            var myChart = Highcharts.chart('container-charts-prospect', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: 0,
                    plotShadow: false
                },
                title: {
                    text: 'Répartition <br>des clients<br>par type',
                    align: 'left',
                    verticalAlign: 'top',
                    y: 40
                },
                xAxis: {
                    categories: [{%  if shops is defined %}{% for key, shop in shops %} '{{ key }}', {% endfor %}{% endif %}]
                },
                series: [{
                    type: 'column',
                    colorByPoint: true,
                    // name: 'Browser share',
                    // innerSize: '50%',

                    data: [
                        {%  if shops is defined %}
                        {#{% for shop in shops %}#}
                        {#['{{  shop.prospect }}', {% if shop.prospect == 1 %}0{% else %}1{% endif %}], //On affiche les clients#}
                        {#['{{ shop.prospect }}',{{ shop.prospect| length }}],#}{# //On affiche les prospects#}
                        {#{% endfor %}#}
                        {% endif %}
                    ],
                    showInLegend: false
                }]
            });
        });
    </script>
{% endblock %}
</body>

</html>